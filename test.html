<!DOCTYPE html>
<html>
  <body>
    <script type="module">
      import { state, effect, onCleanup, html, event, mount } from "./main.js";
      const { p, strong } = html;

      const counter = state(0, (get, set) => ({ increment: () => set(get()++) }));
      const logger = effect((what) => {
        const interval = setInterval(() => console.log(what), 1000);
        onCleanup(() => clearInterval(interval));
        return interval;
      });

      // TODO:
      // - global state would be nice
      // - can effects be async?

      const app = effect(() => {
        const [count, { increment }] = counter(5);
        logger(count);

        if (count === 0) {
          p(strong("Plz restart"));
        } else {
          const numbers = [...Array(count)].map((v,i) => i+1)
          numbersList(...numbers.map(number => li(number)));
        }

        const ref = button({ type: "button" }, event("click", increment));
        logger(ref);

        html["web-component"]("web-component test")
      });

      const numbersList = effect((...children) => {
        ul(...children);
      })

      // mount(document.getElementById("root"), app);
      app()
    </script>

    <div id="root"></div>
  </body>
</html>
