<!DOCTYPE html>
<html>
  <body>
    <script type="module">
      import { state, effect, onCleanup, html, event, getEffect, createRoot } from "./main.js";
      const { p, h1, ul, li, button } = html;

      const counter = state(0, (get, set) => ({
        increment: () => set(get() + 1),
        decrement: () => set(get() - 1),
      }));
      const interval = effect((what) => {
        const timer = setTimeout(() => (console.log("timer firing"), what()), 3000);
        onCleanup(() => {
          console.log("clearing");
          clearTimeout(timer);
        });
      });

      const buttonAttributes = { type: "button" };
      const root = createRoot(document.getElementById("root"));

      const app = effect(
        () => {
          const [count, { increment, decrement }] = counter(1);

          // interval(increment);

          root(
            button(buttonAttributes, "Increment ", count, event("click", increment)),
            button(buttonAttributes, "Decrement ", count, event("click", decrement)),
            count <= 0
              ? h1("Plz start")
              : ul(...[...Array(count)].map((v, index) => listItem(index + 1)))
          );
        },
        undefined,
        "app"
      );

      const listItem = effect(
        (number) => {
          const [count, { increment }] = counter(0);
          // if (count === 0) increment();
          return li(number, button(buttonAttributes, count, event("click", increment)));
        },
        false,
        "listItem"
      );

      app();
    </script>

    <div id="root"></div>
  </body>
</html>
