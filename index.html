<!DOCTYPE html>
<html>
  <body>
    <script type="module">
      import {
        // state,
        // globalState,
        // effect,
        // html,
        // svg,
        // onCleanup,
        // event,
        // createRoot,
        // key,
        root,
        idle,
        state,
        createGlobalState,
        mount,
      } from "./index.js";

      const [globalTest, setGlobalTest] = createGlobalState(0);
      setInterval(() => setGlobalTest(Math.random()), 200);

      const app = async function (hello) {
        // console.log(hello, "world");
        const [counter, setState] = await this(state)(0);
        setTimeout(() => setState(counter + 1), 200);

        let deadline = await idle();

        const values = [];
        for (let index = 0; index < Math.random() * 10; index++) {
          if (deadline.timeRemaining() <= 0) deadline = await idle();
          if (Math.random() > 0.1) values.push(await this(logger, index)());
        }

        this(mount)(
          document.body,
          this("ul")({ style: "color: red", class: "lol", events: { click: console.log } }, values)
        );
      };

      const logger = async function () {
        const [value, setValue] = await this(globalTest)();
        // if (Math.random() < 0.1) throw new Error();
        // console.log(value);
        return this("li")(value);
      };

      root(app)("hello");
    </script>
  </body>
</html>
