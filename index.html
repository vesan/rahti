<!DOCTYPE html>
<html>
  <body>
    <script type="module">
      import {
        state,
        globalState,
        effect,
        html,
        svg,
        onCleanup,
        event,
        createRoot,
      } from "./index.js";
      const { h1, button, p, ul, li, strong, div, header } = html;

      const app = effect((root) => {
        const [count, { increment, decrement }] = counter(5);
        const [deleted, setDeleted] = container();

        const numbers = [];
        for (let index = 0; index < count; index++) {
          if (deleted !== index) numbers.push(listItem(index + 1));
        }

        root(
          masthead(increment, decrement, count, setDeleted),
          count === 0 && p("Try the buttons!"),
          count > 0 && ul(...numbers),
          count < 0 &&
            div(
              svg.svg(
                svg.rect({ width: 300, height: 300, fill: "red" }),
                svg.text("Surprise svg!", { x: 50, y: 50, fill: "white" })
              )
            )
        );
      });

      const masthead = effect(function masthead(increment, decrement, count, setDeleted) {
        return header(
          h1("Count: ", count),
          button("Increment +1", event("click", increment), { type: "button" }),
          button("Decrement -1", event("click", decrement)),
          button(
            "Skip random",
            event("click", () => setDeleted(Math.floor(Math.random() * count)))
          )
        );
      });

      const container = state();
      const today = Date.now();

      const counter = state(0, (get, set) => ({
        increment: () => set(get() + 1),
        decrement: () => set(get() - 1),
      }));

      const globalStateTest = globalState(false);

      const listItem = effect(function listItem(number) {
        if (number < 3) globalStateTest();
        return [li(), li(`${number} last ran at `, (Date.now() - today) / 1000)];
      });

      app(createRoot(document.body));

      const [, setTest] = globalStateTest();
      // setInterval(() => setTest(Date.now()), 2000);
    </script>
  </body>
</html>
